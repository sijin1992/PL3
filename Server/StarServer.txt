一 linux环境配置

yum -y install readline-devel ncurses-devel

1 安装lua

unzip lua-5.2.4.zip
cd lua-5.2.4
make linux
make install

1) Makefile Line44
TO_LIB= liblua.a liblua.so

2) src/Makefile

a Line10
CFLAGS= -O2 -fPIC -Wall -DLUA_COMPAT_ALL $(SYSCFLAGS) $(MYCFLAGS)

b Line32
LUA_A=	liblua.a
LUA_SO=	liblua.so

c Line47
ALL_O= $(BASE_O) $(LUA_O) $(LUAC_O)
ALL_T= $(LUA_A) $(LUA_T) $(LUAC_T) $(LUA_SO)
ALL_A= $(LUA_A)

d Line59
$(LUA_A): $(BASE_O)
	$(AR) $@ $(BASE_O)
	$(RANLIB) $@

$(LUA_SO):$(CORE_O) $(LIB_O)
	$(CC) -o $@ -shared $? -ldl -lm
	

2 kyotocabinet-1.2.76

unzip kyotocabinet-1.2.76.zip
cd kyotocabinet-1.2.76
chmod 755 configure
./configure
make && make install
cp libkyotocabinet.so.16 /usr/lib

注意 /usr/local/lib里面也要有 看看 存不存在 对不对

缺少动态库操作
ln -s /where/you/install/lib/*.so /usr/lib
*************************************sudo ldconfig*************************************

3 kyotocabinet-lua-1.28

unzip kyotocabinet-lua-1.28.zip
cd kyotocabinet-lua-1.28
sed -i 's/lua_objlen/lua_rawlen/g' kyotocabinet.cc
chmod 755 configure
./configure
make && make install
cp kyotocabinet.so /usr/local/services/star_server/bin/logic/main_logic/lua



4 pbc-master

unzip pbc-master.zip
cd pbc-master
make
cd binding/lua
make
gcc -O2 -Wall -fPIC --shared -o protobuf.so -I../.. -I/usr/local/include -L/usr/local/bin -L../../build pbc-lua.c -lpbc -llua
cp protobuf.so /usr/local/services/star_server/bin/logic/main_logic/lua;
cp protobuf.so /usr/local/lib/lua/5.2;

二 mysql

tar xzf mysql-5.1.36.tar.gz
cd mysql-5.1.36
./configure
make

三 protobuf

tar -xzf protobuf-2.5.0.tar.gz
cd protobuf-2.5.0
./configure --prefix=/usr/local/protobuf
make
make check
make install

vi ~/.bash_profile


export CPLUS_INCLUDE_PATH=$CPLUS_INCLUDE_PATH:/usr/local/protobuf/include/
export PATH=$PATH:/usr/local/protobuf/bin/
export PKG_CONFIG_PATH=/usr/local/protobuf/lib/pkgconfig/

source ~/.bash_profile

vi /etc/ld.so.conf.d/protobuf.conf
插入：
/usr/local/protobuf/lib
ldconfig

SecureCrt
sz file 下载
rz -bey 上传

四 编译GameServer

/usr/local/services/star_server/svr80001
所有ini文件更改数据库ip和GameServer IP

1 proto
cd /home/work/star/server/proto
sh update.sh

2 dbsvr
cd /home/work/star/server/dbsvr
sh update.sh

3 connect httpcb gateway
cd /home/work/star/server/connect
sh update.sh

4 session_auth
cd /home/work/star/server/connect/session_auth
sh update.sh

5 main_logic

cd /home/work/star/server/common
make

cd /home/work/star/server/logic
make

cd /home/work/star/server/data_cache
make

cd /home/work/star/libsrc
make

cd /home/work/star/server/main_logic
sh update.sh

6 logsvr

cd /home/work/star/server/logsvr
sh update.sh

7 tcplinker
cd /home/work/star/server/tcplinker
sh update.sh

8 lua_lib
cd /home/work/star/server/lua_lib
sh update

9 svr_centre
cd /home/work/star/server/svr_centre
sh update.sh
sh svr_centre.sh restart
http://192.168.1.66:7000/req?platform=102&uid=1&debug=1

源码目录

/home/work/star

运行目录
/usr/local/services/star_server/svr80001

五 源码说明

db_star_user_data_80001
tab_star_group_0 帮派信息
帮派名称 帮派数据

db_star_user_data_80001
用户名 UserInfo ShipList ItemList MailList

cd /usr/local/services/star_server/svr80001

--查看进程
sh checkAll.sh logic/lock
sh checkAll.sh db/lock
sh checkAll.sh log/lock

--操作
cd /usr/local/services/star_server/svr80001/monitor
sh cleanup.sh
sh server_stop.sh
sh server_start.sh

--重启
cd /usr/local/services/star_server/svr80001/monitor
sh cleanup.sh

cd /usr/local/services/star_server/svr80001/logic/main_logic
sh main_logic.sh restart

cd /usr/local/services/star_server/svr80002/monitor
sh cleanup.sh

cd /usr/local/services/star_server/svr80002/logic/main_logic
sh main_logic.sh restart

cd /usr/local/services/star_server/centre
sh svr_centre.sh restart

--清空

cd /usr/local/services/star_server/svr80001/logic/main_logic
rm -f Planet.kch
rm -f RedoList.kch
rm -f Video.kch
X:\usr\local\services\star_server\svr80001\logic\main_logic


--proto 更新

cd /home/work/star/server/proto
sh update.sh


cd /home/work/star/server/logsvr
sh update.sh

cd /home/work/star/server/dbsvr
sh update.sh

cd /home/work/star/server/main_logic
sh update.sh

cd /home/work/star/server/connect
sh update.sh

cd /home/work/star/server/connect/gateway
sh update.sh

cd /home/work/star/server/connect/session_auth
sh update.sh

cd /usr/local/services/star_server/svr80001/
sh rebuild_proto.sh


Truncate Table `tab_star_main_0`;

aws root Utugame369
aws rds 12345678

外网机注意防火墙关闭 service   iptables status 设置防火墙属性 vi /etc/sysconfig/iptables 

--外网服务器
/usr/local/services/star_server/svr80001/logic/log/main_logic/error

/usr/local/services/star_server/bin/logic/main_logic/lua/logic

https://itunesconnect.apple.com/
账号：utugames@163.com
密码：Utugames123

--GM权限设置
http://192.168.1.222:9096/admin/index.php
lyh
lyh


--centos 开机自启动脚本
开一个文件比如/home/centnet-service.sh
chmod +x /home/centnet-service.sh
chmod +x /etc/rc.d/rc.local
打开/etc/rc.d/rc.local文件,在最后面添加如下脚本
/home/centnet-service.sh

华北服务器
用户名root  密码Utugame188
华北数据库 ip：47.104.4.17
用户名：root
密码：utu54188